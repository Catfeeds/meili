<extend name="Public/base" />
<block name="main">

    <div class="row-fluid main-row-fluid">

        <div class="span12">
            <div class="widget-box">
                <!--<div class="widget-title">
                    <span class="icon">
                        <i class="fa fa-plus"></i>
                    </span>
                    <h5>更新行为信息</h5>
                </div>-->
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#tab1">基本信息</a></li>
                    <!--<li class=""><a data-toggle="tab" href="#tab2">图文详情</a></li>-->
                    <!--<li class=""><a data-toggle="tab" href="#tab3">属性信息</a></li>-->
                </ul>

                <br>
                <form class="form-horizontal text-height-27-form" method="post" action="{:U('Card/update')}">
                    <div class="widget-content tab-content no-padding">
                        <div id="tab1" class="tab-pane active">
                            <input type="hidden" name="model" value="Card">
                            <input type="hidden" name="id" value="{$row['id']}">
                            <div class="control-group">
                                <label class="control-label">一卡通名称</label>
                                <div class="controls">
                                    <input type="text" name="card_name" value="{$row['card_name']}" class="text-width-40" maxlength="60">
                                    <span class="help-block">* 一卡通名称必须</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">该卡字体配色</label>
                                <div class="controls">
                                    <div id="main">
                                        <div class="demo">
                                            <input type="text" id="c1" name="font_color" value="{$row['font_color']}" class="text-width-20">
                                            <span class="help-block">* 点击输入框即可选择颜色</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">选择关联商品（多选）</label>
                                <div class="controls">
                                    <volist name="services" id="ser">
                                        <input type="checkbox" name="service_ids[]" value="{$ser.service_id}" <if condition="in_array($ser['service_id'],$s_ids)">checked='checked'</if>>{$ser.service_name}　
                                    </volist>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">季卡价格&点数</label>
                                <div class="controls">
                                    <span class="input-append">
                                        <input type="text" name="m_price" value="{$row['m_price']}" class="decimal-only text-width-40" placeholder="售价">
                                        <div class="add-on">元 (售价)</div>
                                    </span>
                                    <span class="input-append">
                                        <input type="text" name="m_count" value="{$row['m_count']}" class="decimal-only text-width-40" placeholder="点数">
                                        <div class="add-on">点 (点数)</div>
                                    </span>
                                    <span class="help-block">* 一卡通的季卡价格和点数 <!--如果商品存在属性价格则 最终的售价为：基础销售价格+属性价格--></span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">年卡价格&点数</label>
                                <div class="controls">
                                    <span class="input-append">
                                        <input type="text" name="y_price" value="{$row['y_price']}" class="decimal-only text-width-40" placeholder="售价">
                                        <div class="add-on">元 (售价)</div>
                                    </span>
                                    <span class="input-append">
                                        <input type="text" name="y_count" value="{$row['y_count']}" class="decimal-only text-width-40" placeholder="点数">
                                        <div class="add-on">点 (点数)</div>
                                    </span>
                                    <span class="help-block">* 一卡通的年卡价格和点数 <!--如果商品存在属性价格则 最终的售价为：基础销售价格+属性价格--></span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">开始时间</label>
                                <div class="controls">
                                    <input name="start_time" type="text" value="<?php echo $row['start_time']?date('Y-m-d H:i',$row['start_time']):'';?>" class="text-width-20" id="jedatestart" placeholder="请选择开始时间" readonly>
                                    <!--<input name="end_time" type="text"  class="text-width-20" id="jedateend" placeholder="请选择秒杀结束时间" readonly>-->
                                    <span class="help-block">* 点击即可弹出时间选择器，开始时间必须</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">结束时间</label>
                                <div class="controls">
                                    <input name="end_time" type="text" value="<?php echo $row['end_time']?date('Y-m-d H:i',$row['end_time']):'';?>" class="text-width-20" id="jedatestart_s" placeholder="请选择结束时间" readonly>
                                    <!--<input name="end_time" type="text"  class="text-width-20" id="jedateend" placeholder="请选择秒杀结束时间" readonly>-->
                                    <span class="help-block">* 点击即可弹出时间选择器，结束时间必须</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <span class="help-block">* 只需要选择正确的时分秒即可，年月日请忽略随意填写</span>
                                </div>
                            </div>
                            <!--<div class="control-group">-->
                                <!--<label class="control-label">单位</label>-->
                                <!--<div class="controls">-->
                                    <!--<input type="text" name="unit" value="{$row['unit']}" class="text-width-10">-->
                                    <!--<span class="help-block">* 商品的价格单位</span>-->
                                <!--</div>-->
                            <!--</div>-->
                            <!--<div class="control-group">-->
                                <!--<label class="control-label">库存</label>-->
                                <!--<div class="controls">-->
                                    <!--<input type="text" name="stock" value="{$row['stock']}" class="text-width-10">-->
                                    <!--<span class="help-block">* 商品的剩余库存，设为-1则不限库存&lt;!&ndash;如果商品有多个单选属性，则要设置货品属性库存&ndash;&gt;</span>-->
                                <!--</div>-->
                            <!--</div>-->
                            <div class="control-group">
                                <label class="control-label">封面图片</label>
                                <div class="controls">
                                    {:hook('upload',array('is_first'=>1,'unique_sign'=>'cover','field_name'=>'cover','field_value'=>$row['cover'],'save_path'=>'Card'))}
                                    <span class="help-block">* 一卡通封面图，在列表中显示</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">背景图片</label>
                                <div class="controls">
                                    {:hook('upload',array('unique_sign'=>'bg_cover','field_name'=>'bg_cover','field_value'=>$row['bg_cover'],'save_path'=>'Card'))}
                                    <span class="help-block">* 一卡通背景图，在列表中显示</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">关键字</label>
                                <div class="controls">
                                    <input type="text" name="keywords" value="{$row['keywords']}" class="text-width-20" maxlength="12">
                                    <span class="help-block">一卡通关键字，增加搜索准确性，12字符以内</span>
                                </div>
                            </div>
                            <!--<div class="control-group">
                                <label class="control-label">是否上架</label>
                                <div class="controls">
                                    <label style="margin-right:20px;display:inline">
                                        <div class="radio"><span><input name="is_on_sale" style="opacity: 0;" type="radio" value="1" <if condition="!isset($row['is_on_sale']) or $row['is_on_sale'] eq 1">checked</if>></span></div> 是
                                    </label>
                                    <label style="margin-right:20px;display:inline">
                                        <div class="radio"><span><input name="is_on_sale" style="opacity: 0;" type="radio" value="0" <if condition="isset($row['is_on_sale']) and $row['is_on_sale'] eq 0">checked</if>></span></div> 否
                                    </label>
                                    <span class="help-block">是否上架该商品</span>
                                </div>
                            </div>-->
                            <!--<div class="control-group">
                                <label class="control-label">是否可用积分抵扣</label>
                                <div class="controls">
                                    <label style="margin-right:20px;display:inline">
                                        <div class="radio"><span><input name="is_integral" style="opacity: 0;" type="radio" value="1" <if condition="$row['is_integral'] eq 1">checked</if>></span></div> 是
                                    </label>
                                    <label style="margin-right:20px;display:inline">
                                        <div class="radio"><span><input name="is_integral" style="opacity: 0;" type="radio" value="0" <if condition="empty($row['is_integral'])">checked</if>></span></div> 否
                                    </label>
                                    <span class="help-block">是否可用积分抵扣商品价格，有抵扣比例</span>
                                </div>
                            </div>-->
                            <!--<div class="control-group">
                                <label class="control-label">是否推荐到首页</label>
                                <div class="controls">
                                    <label style="margin-right:20px;display:inline">
                                        <div class="radio"><span><input name="is_best" style="opacity: 0;" type="radio" value="1" <if condition="$row['is_best'] eq 1">checked</if>></span></div> 是
                                    </label>
                                    <label style="margin-right:20px;display:inline">
                                        <div class="radio"><span><input name="is_best" style="opacity: 0;" type="radio" value="0" <if condition="empty($row['is_best'])">checked</if>></span></div> 否
                                    </label>
                                    <span class="help-block">设置为是 则出现在首页</span>
                                </div>
                            </div>-->
                            <div class="control-group">
                                <label class="control-label">排序</label>
                                <div class="controls">
                                    <input type="text" name="sort" value="{$row['sort']}" class="text-width-20" maxlength="15">
                                    <span class="help-block">自定义一卡通排序，数值越大越靠前</span>
                                </div>
                            </div>

                        </div>

                        <!--<div id="tab2" class="tab-pane">-->
                            <!--<textarea name="card_desc">{$row['card_desc']}</textarea>-->
                            <!--{:hook('adminArticleEdit', array('is_first'=>1,'name'=>'card_desc','value'=>$row['card_desc'],'width'=>1010,'height'=>700))}-->
                        <!--</div>-->

                        <!--<div id="tab3" class="tab-pane">
                            <div class="control-group">
                                <label class="control-label">商品类型：</label>
                                <div class="controls">
                                    <select name="type_id" class="type-select select-height-35" data-id="{$row['id']|default=0}">
                                        <option value="0">--请选择商品类型--</option>
                                        <volist name="type_list" id="type">
                                            <option value="{$type['type_id']}" <eq name="row['type_id']" value="$type['type_id']">selected</eq>>{$type['type_name']}</option>
                                        </volist>
                                    </select>
                                    <span class="help-block">请选择商品的所属类型，进而完善此商品的属性</span>
                                </div>
                            </div>
                            <div id="attr-form">
                                {$goods_attr_form}
                            </div>
                        </div>-->

                        <div class="form-actions">
                            <button class="btn" onclick="javascript:history.back(-1);return false;">返 回</button>　
                            <button class="btn btn-info ajax-post" target-form="form-horizontal" type="submit">保 存</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</block>
<block name="script">
    <link type="text/css" rel="stylesheet" href="__STATIC__/plugins/jedate-6.5.0/skin/jedate.css">
    <script src="__STATIC__/plugins/jedate-6.5.0/jedate.js"></script>
    <link type="text/css" rel="stylesheet" href="__STATIC__/plugins/s_color/css/jquery.bigcolorpicker.css">
    <!--<script src="__STATIC__/plugins/s_color/js/jquery-1.12.3.min.js"></script>-->
    <script src="__STATIC__/plugins/s_color/js/jquery.bigcolorpicker.min.js"></script>
    <script>
        $(function () {
            //获取属性
            $(".type-select").change(function () {
                var goods_id = $(this).attr('data-id'), type_id = $(this).val();
                if (type_id == 0) {
                    $('#attr-form').html('');
                } else {
                    $.ajax({
                        url: '{:U("ActivityGroupService/ajaxAttrForm")}',
                        type: 'POST',
                        dataType: 'json',
                        data: {card_id: goods_id, type_id: type_id},
                        success: function (data) {
                            $('#attr-form').html(data.form);
                        }
                    });
                }
            });
        });

        //增加一个节点
        function addSpec(obj) {
            var html = '<div class="control-group">' +
                '<label class="control-label">' + $(obj).parent().parent().find('label').html() + '</label>' +
                '<div class="controls">' + $(obj).parent().html().replace(/(.*)(addSpec)(.*)(\[)(\+)/i, "$1removeSpec$3$4-") + '</div>' +
                '</div>';
            $(obj).parent().parent().next('.add-area').append(html);
        }
        //删除一个节点
        function removeSpec(obj) {
            $(obj).parent().parent().remove();
        }
    </script>
    <script>
        jeDate("#jedatestart", {
            // festival:true,                      //显示农历
            minDate: "1970-01-01",              //最小日期
            maxDate: "2099-12-31",              //最大日期
            format: "YYYY-MM-DD hh:mm",       //控制可选属性(年月日时分秒)
            donefun: function (obj) {              //选择完成回调
                var jedateend = document.getElementById("jedateend");
                if (jedateend) {
                    if (jedateend.value && jedateend.value < obj.val) {
                        jedateend.value = obj.val;
                    }
                }
            }
        });
        jeDate("#jedatestart_s", {
            // festival:true,                      //显示农历
            minDate: "1970-01-01",              //最小日期
            maxDate: "2099-12-31",              //最大日期
            format: "YYYY-MM-DD hh:mm",       //控制可选属性(年月日时分秒)
            donefun: function (obj) {              //选择完成回调
                var jedateend = document.getElementById("jedateend_s");
                if (jedateend) {
                    if (jedateend.value && jedateend.value < obj.val) {
                        jedateend.value = obj.val;
                    }
                }
            }
        });
        // jeDate("#jedateend",{
        //     // festival:true,                      //显示农历
        //     minDate:"1970-01-01",              //最小日期
        //     maxDate:"2099-12-31",              //最大日期
        //     format: "YYYY-MM-DD hh:mm",       //控制可选属性(年月日时分秒)
        //     donefun:function (obj) {              //选择完成回调
        //         var jedatestart=document.getElementById("jedatestart");
        //         if(jedatestart){
        //             if(jedatestart.value && jedatestart.value > obj.val){
        //                 jedatestart.value = obj.val;
        //             }
        //         }
        //     }
        // });
    </script>
    <script>
        $(function(){
            $("#c1").bigColorpicker("c1");
            $("#btn").bigColorpicker("c2");
        });
    </script>
</block>
